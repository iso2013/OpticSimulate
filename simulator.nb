(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     72288,       1728]
NotebookOptionsPosition[     70709,       1696]
NotebookOutlinePosition[     71168,       1713]
CellTagsIndexPosition[     71125,       1710]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData["0"], "Input",
 CellChangeTimes->{{3.8783917367582865`*^9, 3.878391737797387*^9}, 
   3.878391790049674*^9},ExpressionUUID->"2105f55d-ac97-4ab9-a64d-\
6df410f46ac2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"OpticSimulate", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"4", ",", "3"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0.1", ",", "0.1", ",", "0", ",", "1.5", ",", 
        RowBox[{"BasicMirror", "[", "]"}]}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "1", ",", 
        RowBox[{"BasicMirror", "[", "]"}]}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.75"}], ",", " ", 
        RowBox[{"-", "0.5"}], ",", " ", 
        RowBox[{
         RowBox[{"Pi", "/", "2"}], "-", "0.15"}], ",", " ", "1", ",", " ", 
        RowBox[{"BasicMirror", "[", "]"}]}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1.235", ",", 
        RowBox[{"9", 
         RowBox[{"Pi", "/", "16"}]}], ",", "2", ",", 
        RowBox[{"BasicMirror", "[", "]"}]}], "}"}]}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.876508299726755*^9, 3.8765083663491635`*^9}, 
   3.8765084297677917`*^9, {3.876508505739152*^9, 3.8765085125654736`*^9}, {
   3.8765090989461727`*^9, 3.876509222700794*^9}, {3.876509470665447*^9, 
   3.8765094712495584`*^9}, {3.8765095177107096`*^9, 
   3.8765095446200185`*^9}, {3.876509612740634*^9, 3.87650970934418*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"c39da14e-dbc7-4489-88bd-45449c789b4f"],

Cell[BoxData[
 GraphicsBox[{
   {GrayLevel[0.85], 
    RectangleBox[NCache[{-2, Rational[-3, 2]}, {-2, -1.5}], 
     NCache[{2, Rational[3, 2]}, {2, 1.5}]]}, 
   {RGBColor[0, 0, 1], PointSize[0.01], PointBox[CompressedData["
1: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
clPejWLFOrJ/6pQKhDXGa8n+SlhfFPqhuJbsP+81P1WkQmrJ/rSULsv3vVxL
9u+eFZXGUxq1ZH9LLq1h286vJft/YNEv1+bGGnI+ShbQxPU/1ZDzEy3SFJNz
u4acL9fZdE0VvRpy/kz4bRWR0jXkfG6f6rBc1FdNzq/oGHPULaeanG/mYI/v
wONqcv7zuBzZ8+bVZD6EsvtTqlWqyfxwZA7qHOBXkfliwBhpTKmsIvNHiT5u
vy6qiswnwf8N+GR+Nf/iBQrtryLzLaN61kanJVVk/q0Om+daWlBJ5mON/6KY
OKtKMj8f+C6reDynksxX9furRu1jKsj87b0pJ2t4qILM50gHRZ1trHIyv49f
3mwv7lNO5rvQ+R2BQxvKyfz/bKKRW1dSRvThiiEw023LiH7IHNYWCxItI/pS
BUfVXOJLif547DpufsaglOiT2pbTXpr9JUS/ehTMElY9KyH6Fi57oX56awnR
v2OSl3kt1T+JPgqKXVPAGz+JfqbPcTKIkvhJ9PXSzC3ne2nFRH9XjbhHWp4q
JvpcwfEqOjj6g+j3vU4/7vqgH0TfVZv9JYXVfxD9764N1uqmFRF/EFoaaVN8
s4j4B/2C6CcfpIqIvxDI/pjhm/2d+I/UlCS67dnvxJ/YfMwQ1p8pJP5l5Zuv
KiqRhcTflIXkGy+CQuJ/3J4Xuw60FhB/tN2nIqbavYD4py73uooUuQLir4Jd
GkcD8vOJ/zp6vU3W6UI+8We8i0wdY6F84t+SLTj2u959I/7O6vRg4Aqdb8T/
LT82njvBzCP+sESHx2x8mEf8410toUVflfKIvzxnt9ReMwCJ/yz6e03udF0u
8aebjm4SQ8lc4l/9NdXN75nkEH87vuGvhIOhX4n/NV9pyJvTnE38ceHcswbF
MtnEPyuPX4z0tcgi/vpZ9z9cvddfiP8erXfTWtSRSfz52aJHT6rXZxL/np8e
RA+w+Uz8vdK7tyrGsRnE/z95kei6gp1O8sGwR3ZF48Z0kh9M//khG3E1jeSL
PMtae4vEVJI/FE605sr9SSH5xG//f4AtheSXwa1j5jGOySTfmKyZnXgpI4nk
nzurZXmnBhJJPjrM2xnZ+E8CyU9LW/S1LMbiSL5qy7amd9z6RPJXXOhd10u8
DySfudx8Kdt3L5bkt79M4nMd5rwn+W7xru/mo97vSP5rXtbCuyUaTfJh7PBw
JP/pG5IfHWtFwVPiNcmX96yO5C5ReUXyp9TamzypneEkn6a2/geYQkh+1Yug
uW4+GEjybZfpXFTTDSD513WFOh+OPyP5eHPcf4Hfl+Rnc8Ut/OhcT5KvZbX/
M6x3Sf52393MD0h3IPnc94edYKfOaZLfOeZBkw8PmyCV703amTPTIw5I5f9R
tuJMw++7SPEB3Vuqrr/pnkjxg5X8upmiKl+k+MLwtywt0/PPkOIPfws94hma
BiDFJ/J1/s49ZBSIFL/Y4LPRVUsvBCm+8ax0au9O7XCk+MfYwrKZjVqvkOIj
W5QqzJ+veo0UP7lwJCNXNPgNUnwl6EqkrPfSaKT4S+kjL9fZz98hxWf4cfZ0
14XvkeI3OyqMtSZ9YpHiOxf7tSKdhD8ixX/CFivyBu5/QooPVW5bZG7Hj0OK
H802Gsvpvp2AFF/a5dgqc2E8ESn+lF7SoXUtKwkpPnWsqYEb55KMFL/q6S2N
ZKulIMW3PKbRQGkkBSn+JbMwjWedmooUH/ssE5vw1iENKX52XCXcvH1LOlJ8
rVfrmdhqbjpS/O3BMc/cs3EZSPG51edc7EOvfEaK3325bidLU8pEiu8Z3TtX
saw7Eyn+1/f8pKvRuy9I8cGHbw6rPL+QhRQ/lEvdQ6+Qy0aKL2YXbH0i2paN
FH88VbdeSzfyK1J8sr9zBffh2Ryk+KXPiGjkd6lcpPjmOuFZBrN/5yLFP3Mk
R2b2BSFSfPRTwLAxKuchxU/Hw7gqdJ88pPiqdjRLeIaVhxR/9Y9j0Fcd/oYU
n21Na87QfP8NKX67Kaf+yRnhfKT47s3vVTYu1vlI8d+i8hKtoMJ8pPiwRH2h
ZMa6AqT48Tl6LrfufgFSfDmemVk01F6AFH+e5KZEiu8vRIpPHxqLc94WVYgU
v37BjzEw5BcixbfbRV4rXDP/jhT/Vlkcxnuc8x0pPn57xcv6OOkipPh58Zqn
CaW3i5Di68s2+HixG4uQ4u+W2zzM52n+QIrPJ2rcVVMK+YEUv5/e/6/YofEf
SPH9I7oOTOvTxUjx/8ATtrmeGcVI9QMdptaBb5f9RKo/2HrBwj7f8SdS/cJd
2zM67bU/keofSv4xkhXYUYJUP7H8jv6orH8JUv2Fleehir1/SpDqN5L99sec
NSxFqv/gvdjtejuxFKl+5GjETuNQsTKk+pPgd1tUvlwtQ6pf6YrfIEwrK0Oq
f9mesY4+urEcqX7GLVcmY9mjcqT6m7Ki5U9U2eVI9TsrK5fYGB2pQKr/sWlY
oHUjtgKpfii1dY7kc5FKpPojARa/L9GmEql+SX9g4nvF90qk+if96YkKZ/Eq
pPqpfwTGNIUPVCHVX4UIDce8dKhCqt/CuX/E5V9XIdV/dYlyXdOqqpDqxxYs
6WUfFKhGqj/btoxlXLulGgX+95V3emVXvqVFNc5LCVgdIiGQd1eGoTL4pBr/
BxtPG1U=
     "]], 
    {GrayLevel[0], Thickness[0.01], LineBox[{{0.1, -0.65}, {0.1, 0.85}}]}, 
    {GrayLevel[0], Thickness[0.01], LineBox[{{1., -0.5}, {1., 0.5}}]}, 
    {GrayLevel[0], Thickness[0.01], 
     LineBox[{{-1.2443855389680212`, -0.5747190662367999}, \
{-0.2556144610319789, -0.4252809337632004}}]}, 
    {GrayLevel[0], Thickness[0.01], 
     LineBox[{{-0.9807852804032304, 1.4300903220161283`}, {0.9807852804032304,
       1.039909677983872}}]}}}]], "Output",
 CellChangeTimes->{{3.876509624145018*^9, 3.876509672040341*^9}, {
  3.8765097074530177`*^9, 3.876509709963314*^9}},
 CellLabel->"Out[53]=",ExpressionUUID->"6c809ca2-1711-4c72-97c8-ea7626c05acf"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.876508435836534*^9, 
  3.876508437677958*^9}},ExpressionUUID->"31069f6a-6b6e-4274-805a-\
65f1de1a729d"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"OpticSimulate", "[", 
   RowBox[{"dims_", ",", " ", "elements_List", ",", " ", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ExecLimit", "->", "10000"}], ",", " ", 
       RowBox[{"Sources", "->", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2"}], ",", "1", ",", 
           RowBox[{
            RowBox[{"-", "3"}], 
            RowBox[{"Pi", "/", "32"}]}], ",", " ", "0.02"}], "}"}], "}"}]}], 
       ",", " ", 
       RowBox[{"Size", "->", "0.05"}]}], "}"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "canvas", ",", " ", "source", ",", " ", "res", ",", " ", "graphics", ",",
       " ", "velX", ",", " ", "velY"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"canvas", " ", "=", " ", 
      RowBox[{"Rectangle", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "/", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ")"}]}], "/", "2"}]}], "}"}], 
        ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dims", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ")"}], "/", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"dims", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ")"}], "/", "2"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"source", " ", "=", " ", 
      RowBox[{
       RowBox[{"OptionValue", "[", "Sources", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"velX", " ", "=", " ", 
      RowBox[{
       RowBox[{"source", "[", 
        RowBox[{"[", "4", "]"}], "]"}], " ", 
       RowBox[{"Cos", "[", 
        RowBox[{"source", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"velY", " ", "=", " ", 
      RowBox[{
       RowBox[{"source", "[", 
        RowBox[{"[", "4", "]"}], "]"}], 
       RowBox[{"Sin", "[", 
        RowBox[{"source", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"source", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "=", "velX"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"source", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "=", "velY"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"SimulBeam", "[", 
       RowBox[{"dims", ",", " ", "elements", ",", " ", "source", ",", " ", 
        RowBox[{"OptionValue", "[", "ExecLimit", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"graphics", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"LightGray", ",", " ", "canvas", ",", " ", "Blue", ",", " ", 
        RowBox[{"PointSize", "[", "0.01", "]"}], ",", " ", 
        RowBox[{"Point", "[", "res", "]"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"graphics", ",", " ", "#"}], "]"}], " ", "&"}], " ", "/@", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"elem", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "[", "\"\<graphics\>\"", "]"}], 
          "[", 
          RowBox[{
           RowBox[{"elem", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"elem", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"elem", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", 
           RowBox[{"elem", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"elem", ",", " ", "elements"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Graphics", "[", "graphics", "]"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"OpticSimulate", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"4", ",", "3"}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "1", ",", 
       RowBox[{"BasicMirror", "[", "]"}]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.75"}], ",", " ", 
       RowBox[{"-", "0.5"}], ",", " ", 
       RowBox[{
        RowBox[{"Pi", "/", "2"}], "-", "0.15"}], ",", " ", "1", ",", " ", 
       RowBox[{"BasicMirror", "[", "]"}]}], "}"}]}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.875835871897627*^9, 3.87583607878802*^9}, {
   3.875836120606785*^9, 3.8758361385978723`*^9}, {3.875836173467476*^9, 
   3.875836206640663*^9}, {3.875836237261438*^9, 3.8758363249565783`*^9}, {
   3.8758363554687843`*^9, 3.8758364410965214`*^9}, {3.8758364792696996`*^9, 
   3.875836480935673*^9}, {3.8758365401666856`*^9, 3.8758365404803004`*^9}, {
   3.8758369434264545`*^9, 3.8758371915188475`*^9}, {3.875837253200945*^9, 
   3.8758373352750916`*^9}, {3.875837446102221*^9, 3.8758374552612953`*^9}, {
   3.875837506095669*^9, 3.8758378403552876`*^9}, {3.8758378747967424`*^9, 
   3.875837930148054*^9}, {3.8758379679963293`*^9, 3.8758379686142654`*^9}, {
   3.875838016186445*^9, 3.8758380565931187`*^9}, {3.875838294487295*^9, 
   3.8758382945163074`*^9}, {3.8758384121095695`*^9, 3.875838448979801*^9}, 
   3.875838519424723*^9, {3.875838812262034*^9, 3.875838855502879*^9}, {
   3.875838910954466*^9, 3.8758389251705747`*^9}, {3.875838998660799*^9, 
   3.8758390088111243`*^9}, {3.8758390501372995`*^9, 
   3.8758391926857986`*^9}, {3.875903950769478*^9, 3.8759039851228476`*^9}, {
   3.8759040310996203`*^9, 3.875904071514637*^9}, {3.87591103299181*^9, 
   3.8759110415360017`*^9}, {3.875911121085024*^9, 3.8759111247772155`*^9}, {
   3.875911348347992*^9, 3.875911431725218*^9}, {3.8759115134022675`*^9, 
   3.875911663095248*^9}, {3.8759117371693707`*^9, 3.875911938170817*^9}, {
   3.8759120136690445`*^9, 3.875912049744756*^9}, {3.8759121496532784`*^9, 
   3.875912150678029*^9}, {3.8759123951489305`*^9, 3.8759123982064285`*^9}, {
   3.876508171700723*^9, 3.8765081941192446`*^9}, {3.8765082440504103`*^9, 
   3.8765082616657634`*^9}, {3.8765083943214493`*^9, 
   3.8765084121340466`*^9}, {3.876508453977337*^9, 3.8765084907241096`*^9}, {
   3.876508716493845*^9, 3.8765087676884155`*^9}, {3.876508821055339*^9, 
   3.876508872485226*^9}, {3.876509918222786*^9, 3.876510008949745*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"21ecdc82-dd4f-4d00-b944-28dc82a281f7"],

Cell[BoxData[
 GraphicsBox[{
   {GrayLevel[0.85], 
    RectangleBox[NCache[{-2, Rational[-3, 2]}, {-2, -1.5}], 
     NCache[{2, Rational[3, 2]}, {2, 1.5}]]}, 
   {RGBColor[0, 0, 1], PointSize[0.01], PointBox[CompressedData["
1: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
Z1e4T29gYyuU2UMyc00kwv8An1XsvA==
     "]], 
    {GrayLevel[0], Thickness[0.01], LineBox[{{1., -0.5}, {1., 0.5}}]}, 
    {GrayLevel[0], Thickness[0.01], 
     LineBox[{{-1.2443855389680212`, -0.5747190662367999}, \
{-0.2556144610319789, -0.4252809337632004}}]}}},
  ImageSize->{535.8, Automatic}]], "Output",
 CellChangeTimes->{{3.875839161669061*^9, 3.875839193719349*^9}, {
   3.8759040730529757`*^9, 3.87590408244506*^9}, 3.8759041334342685`*^9, 
   3.8759111021342773`*^9, {3.8759111430699687`*^9, 3.8759111724768286`*^9}, 
   3.875911252539445*^9, {3.8759112828713627`*^9, 3.8759113923736134`*^9}, {
   3.8759114250429535`*^9, 3.8759114361305313`*^9}, {3.875911495032791*^9, 
   3.8759115310850506`*^9}, 3.8759116418451014`*^9, {3.8759117860419073`*^9, 
   3.8759118732803583`*^9}, {3.8759119240453887`*^9, 
   3.8759119389018784`*^9}, {3.8759120151648245`*^9, 3.87591205050559*^9}, 
   3.8759121144000254`*^9, 3.875912151634637*^9, 3.8759124032139745`*^9, 
   3.8765081885870266`*^9, {3.876508240346401*^9, 3.8765082622458687`*^9}, {
   3.8765084004872656`*^9, 3.876508412935529*^9}, {3.876508468727331*^9, 
   3.8765084914799523`*^9}, {3.8765087734658794`*^9, 3.876508797388303*^9}, {
   3.8765088294396315`*^9, 3.876508873210675*^9}, 3.8765090478665514`*^9, 
   3.8765090849717426`*^9, {3.876509919389103*^9, 3.8765100095828915`*^9}},
 CellLabel->"Out[71]=",ExpressionUUID->"abc41490-edaa-4420-b5a2-4141d82f1eb5"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"BasicMirror", "[", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"check", ",", " ", "update", ",", "  ", "render"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"check", "[", 
       RowBox[{"x_", ",", " ", "y_", ",", " ", "xV_", ",", " ", "yV_"}], 
       "]"}], " ", ":=", " ", 
      RowBox[{
       RowBox[{"Sign", "[", "x", "]"}], "!=", 
       RowBox[{"Sign", "[", 
        RowBox[{"x", " ", "+", " ", "xV"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"update", "[", 
       RowBox[{"x_", ",", " ", "y_", ",", " ", "xV_", ",", " ", "yV_"}], 
       "]"}], " ", ":=", " ", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "res", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"ToPolarCoordinates", "[", 
           RowBox[{"{", 
            RowBox[{"yV", ",", " ", "xV"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", 
          RowBox[{"res", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"2", "Pi"}], "-", 
           RowBox[{"res", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ">", "Pi"}], ",", 
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"2", "Pi"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "<=", 
            RowBox[{"-", "Pi"}]}], ",", 
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "+", 
             RowBox[{"2", "Pi"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"FromPolarCoordinates", "[", "res", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{"x", ",", " ", "y", ",", " ", 
            RowBox[{"res", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
            RowBox[{"res", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"render", "[", 
       RowBox[{"x_", ",", " ", "y_", ",", " ", "theta_", ",", " ", "scale_"}],
        "]"}], " ", ":=", " ", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "}"}], ",", 
        RowBox[{"p", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{"Black", ",", " ", 
            RowBox[{"Thickness", "[", "0.01", "]"}], ",", " ", 
            RowBox[{"Line", "[", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"0.5", " ", "scale", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"theta", "+", "Pi"}], "]"}]}], ")"}], " ", "+", 
                  " ", "x"}], ",", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"0.5", " ", "scale", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"theta", "+", "Pi"}], "]"}]}], ")"}], " ", "+", 
                  " ", "y"}]}], "}"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"0.5", "scale", " ", 
                    RowBox[{"Sin", "[", "theta", "]"}]}], ")"}], " ", "+", 
                  " ", "x"}], ",", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"0.5", "scale", " ", 
                    RowBox[{"Cos", "[", "theta", "]"}]}], ")"}], " ", "+", 
                  " ", "y"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], 
             "]"}]}], "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"<|", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\"\<bounds\>\"", "->", 
         RowBox[{
          RowBox[{"x", ">", 
           RowBox[{"-", "0.1"}]}], " ", "&&", " ", 
          RowBox[{"x", " ", "<", " ", "0.1"}], " ", "&&", " ", 
          RowBox[{"y", " ", ">", " ", 
           RowBox[{"-", "0.5"}]}], " ", "&&", " ", 
          RowBox[{"y", " ", "<", " ", "0.5"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<checkFunc\>\"", "->", " ", "check"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<updateFunc\>\"", "->", " ", "update"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<graphics\>\"", " ", "->", " ", "render"}]}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"\"\<graphics\>\"", " ", "->", " ", 
         RowBox[{"{", 
          RowBox[{"Black", ",", " ", 
           RowBox[{"Thickness", "[", "0.01", "]"}], ",", " ", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", " ", 
                RowBox[{"-", "0.5"}]}], " ", "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"0", ",", " ", "0.5"}], " ", "}"}]}], "}"}], "]"}]}], 
          "}"}]}], "*)"}], "\[IndentingNewLine]", "|>"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8758185500181284`*^9, 3.8758185969161882`*^9}, {
   3.8758186747262697`*^9, 3.875818817513564*^9}, {3.8758188931833887`*^9, 
   3.8758190207430677`*^9}, {3.8758190532542305`*^9, 3.875819124516367*^9}, {
   3.8758191728733015`*^9, 3.875819216687309*^9}, {3.87582916192457*^9, 
   3.8758291761674414`*^9}, {3.875831440983822*^9, 3.875831476736971*^9}, {
   3.875831510901352*^9, 3.8758315348035426`*^9}, {3.875831575788556*^9, 
   3.8758316361618247`*^9}, {3.875831667310788*^9, 3.875831722490492*^9}, {
   3.875831768398773*^9, 3.8758317724256706`*^9}, {3.8758318138205557`*^9, 
   3.8758318331904345`*^9}, {3.8758318813411098`*^9, 3.875831962208619*^9}, {
   3.8758320113050833`*^9, 3.87583202531182*^9}, {3.8758351720198193`*^9, 
   3.875835296310714*^9}, {3.875835384463415*^9, 3.875835399567752*^9}, {
   3.875835450866711*^9, 3.875835565708639*^9}, {3.8758356579921694`*^9, 
   3.8758358272943583`*^9}, {3.875837314413283*^9, 3.8758373259846363`*^9}, {
   3.875837367430442*^9, 3.87583742814404*^9}, {3.8758379918891306`*^9, 
   3.8758380080034466`*^9}, {3.875838944514474*^9, 3.87583894631695*^9}, {
   3.875904145627627*^9, 3.8759042024703884`*^9}, {3.875911052057429*^9, 
   3.875911087924094*^9}, {3.875911134482498*^9, 3.8759113192053285`*^9}, {
   3.875911373090905*^9, 3.8759113758512*^9}, {3.876512113972271*^9, 
   3.876512114050276*^9}, 3.8783936257757177`*^9, 
   3.878394507689911*^9},ExpressionUUID->"a4a19f7c-f271-4908-b655-\
cd6619e20e9d"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SimulBeam", "[", 
    RowBox[{"dims_", ",", "elements_", ",", "coords_", ",", "execLimit_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"result", ",", " ", "photon", ",", " ", "execs"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"result", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"photon", "=", "coords"}], ";", "\[IndentingNewLine]", 
      RowBox[{"execs", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"execs", " ", "<", "execLimit"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Advance", " ", "the", " ", "photon", " ", "by", " ", "running", " ",
           "the", " ", "simulation", " ", "once"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"photon", "=", 
          RowBox[{"SimulPhoton", "[", 
           RowBox[{"dims", ",", " ", "elements", ",", "photon"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"If", " ", 
            RowBox[{"it", "'"}], "s", " ", "out", " ", "of", " ", "bounds"}], 
           ",", " ", "break"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"photon", "==", 
            RowBox[{"{", "}"}]}], ",", " ", 
           RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Apply", " ", "the", " ", "velocity", " ", "of", " ", "the", " ", 
           RowBox[{"photon", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"photon", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"photon", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", 
           RowBox[{"photon", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"photon", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"photon", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "+", 
           RowBox[{"photon", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Append", " ", "the", " ", "resulting", " ", 
           RowBox[{"photon", "'"}], "s", " ", 
           RowBox[{"position", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"result", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"photon", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"photon", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Increment", " ", "the", " ", "execution", " ", "counter"}],
           " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"execs", " ", "=", " ", 
          RowBox[{"execs", " ", "+", " ", "1"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "result", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SimulBeam", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"4", ",", "3"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1.5"}], ",", "0", ",", "0", ",", "1.7", ",", 
      RowBox[{"BasicMirror", "[", "]"}]}], "}"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2"}], ",", "1", ",", "0.01", ",", " ", 
     RowBox[{"-", "0.0032"}]}], "}"}], ",", "\[IndentingNewLine]", "400"}], 
  "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.875833698045526*^9, 3.8758338038195086`*^9}, {
   3.8758338518138103`*^9, 3.8758338880479584`*^9}, {3.875833918132182*^9, 
   3.875833921611245*^9}, {3.875833957436711*^9, 3.8758340469209595`*^9}, {
   3.87583418499202*^9, 3.875834215318697*^9}, {3.8758342942062554`*^9, 
   3.875834663427458*^9}, {3.875834696998088*^9, 3.8758347705862045`*^9}, {
   3.8758365635884557`*^9, 3.8758365964853644`*^9}, 3.8758368442562003`*^9, {
   3.875836897410664*^9, 3.875836905797656*^9}, {3.875838179657745*^9, 
   3.8758382671448293`*^9}, 3.8758385346798477`*^9, {3.875838574662977*^9, 
   3.875838623728588*^9}, {3.875838760549022*^9, 3.8758387983797703`*^9}, 
   3.8765094864746485`*^9, 3.87650974043328*^9},
 CellLabel->"In[54]:=",ExpressionUUID->"7ce3a26c-3531-4f71-b4bf-dc6f3e5026a7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.99`"}], ",", "0.9968`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.98`"}], ",", "0.9936`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.97`"}], ",", "0.9904000000000001`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.96`"}], ",", "0.9872000000000001`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.95`"}], ",", "0.9840000000000001`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.94`"}], ",", "0.9808000000000001`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.93`"}], ",", "0.9776000000000001`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.92`"}], ",", "0.9744000000000002`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.91`"}], ",", "0.9712000000000002`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.9`"}], ",", "0.9680000000000002`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.89`"}], ",", "0.9648000000000002`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.88`"}], ",", "0.9616000000000002`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8699999999999999`"}], ",", "0.9584000000000003`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8599999999999999`"}], ",", "0.9552000000000003`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8499999999999999`"}], ",", "0.9520000000000003`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8399999999999999`"}], ",", "0.9488000000000003`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8299999999999998`"}], ",", "0.9456000000000003`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8199999999999998`"}], ",", "0.9424000000000003`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8099999999999998`"}], ",", "0.9392000000000004`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7999999999999998`"}], ",", "0.9360000000000004`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7899999999999998`"}], ",", "0.9328000000000004`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7799999999999998`"}], ",", "0.9296000000000004`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7699999999999998`"}], ",", "0.9264000000000004`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7599999999999998`"}], ",", "0.9232000000000005`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7499999999999998`"}], ",", "0.9200000000000005`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7399999999999998`"}], ",", "0.9168000000000005`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7299999999999998`"}], ",", "0.9136000000000005`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7199999999999998`"}], ",", "0.9104000000000005`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7099999999999997`"}], ",", "0.9072000000000006`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6999999999999997`"}], ",", "0.9040000000000006`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6899999999999997`"}], ",", "0.9008000000000006`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6799999999999997`"}], ",", "0.8976000000000006`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6699999999999997`"}], ",", "0.8944000000000006`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6599999999999997`"}], ",", "0.8912000000000007`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6499999999999997`"}], ",", "0.8880000000000007`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6399999999999997`"}], ",", "0.8848000000000007`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6299999999999997`"}], ",", "0.8816000000000007`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6199999999999997`"}], ",", "0.8784000000000007`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6099999999999997`"}], ",", "0.8752000000000008`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5999999999999996`"}], ",", "0.8720000000000008`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5899999999999996`"}], ",", "0.8688000000000008`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5799999999999996`"}], ",", "0.8656000000000008`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5699999999999996`"}], ",", "0.8624000000000008`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5599999999999996`"}], ",", "0.8592000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5499999999999996`"}], ",", "0.8560000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5399999999999996`"}], ",", "0.8528000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5299999999999996`"}], ",", "0.8496000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5199999999999996`"}], ",", "0.8464000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5099999999999996`"}], ",", "0.843200000000001`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5199999999999996`"}], ",", "0.8400000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5299999999999996`"}], ",", "0.8368000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5399999999999996`"}], ",", "0.8336000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5499999999999996`"}], ",", "0.8304000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5599999999999996`"}], ",", "0.8272000000000009`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5699999999999996`"}], ",", "0.824000000000001`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5799999999999996`"}], ",", "0.820800000000001`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5899999999999996`"}], ",", "0.817600000000001`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.5999999999999996`"}], ",", "0.814400000000001`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6099999999999997`"}], ",", "0.811200000000001`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6199999999999997`"}], ",", "0.808000000000001`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6299999999999997`"}], ",", "0.8048000000000011`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6399999999999997`"}], ",", "0.8016000000000011`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6499999999999997`"}], ",", "0.7984000000000011`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6599999999999997`"}], ",", "0.7952000000000011`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6699999999999997`"}], ",", "0.7920000000000011`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6799999999999997`"}], ",", "0.7888000000000012`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6899999999999997`"}], ",", "0.7856000000000012`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6999999999999997`"}], ",", "0.7824000000000012`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7099999999999997`"}], ",", "0.7792000000000012`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7199999999999998`"}], ",", "0.7760000000000012`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7299999999999998`"}], ",", "0.7728000000000013`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7399999999999998`"}], ",", "0.7696000000000013`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7499999999999998`"}], ",", "0.7664000000000013`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7599999999999998`"}], ",", "0.7632000000000013`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7699999999999998`"}], ",", "0.7600000000000013`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7799999999999998`"}], ",", "0.7568000000000014`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7899999999999998`"}], ",", "0.7536000000000014`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.7999999999999998`"}], ",", "0.7504000000000014`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8099999999999998`"}], ",", "0.7472000000000014`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8199999999999998`"}], ",", "0.7440000000000014`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8299999999999998`"}], ",", "0.7408000000000015`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8399999999999999`"}], ",", "0.7376000000000015`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8499999999999999`"}], ",", "0.7344000000000015`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8599999999999999`"}], ",", "0.7312000000000015`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8699999999999999`"}], ",", "0.7280000000000015`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.88`"}], ",", "0.7248000000000016`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.89`"}], ",", "0.7216000000000016`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.9`"}], ",", "0.7184000000000016`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.91`"}], ",", "0.7152000000000016`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.92`"}], ",", "0.7120000000000016`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.93`"}], ",", "0.7088000000000017`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.94`"}], ",", "0.7056000000000017`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.95`"}], ",", "0.7024000000000017`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.96`"}], ",", "0.6992000000000017`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.97`"}], ",", "0.6960000000000017`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.98`"}], ",", "0.6928000000000017`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.99`"}], ",", "0.6896000000000018`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.`"}], ",", "0.6864000000000018`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.01`"}], ",", "0.6832000000000018`"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.876509753210885*^9},
 CellLabel->"Out[55]=",ExpressionUUID->"dff6c7b9-eefc-4811-86de-50291bee6535"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.875838235849987*^9, 
  3.8758382371226845`*^9}},ExpressionUUID->"1ef12c1f-d7d6-45cb-8866-\
260e1b01cedc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SimulPhoton", "[", 
   RowBox[{"dims_", ",", " ", "elements_", ",", " ", "coords_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"toProcess", ",", " ", "checkAndEval", ",", " ", "pos"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Okay", ",", " ", 
      RowBox[{
      "so", " ", "elements", " ", "has", " ", "a", " ", "list", " ", "of", 
       " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "x", ",", " ", "y", ",", " ", "theta", ",", " ", "scale", ",", " ", 
          "Element"}], "}"}], ".", " ", 
        RowBox[{"Let", "'"}]}], "s", " ", "filter", " ", "it", " ", "so", " ",
        "we", " ", "have", " ", "just", " ", "the", " ", "elements", " ", 
       "that", " ", 
       RowBox[{"apply", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pos", " ", "=", " ", "coords"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Check", " ", "if", " ", 
       RowBox[{"we", "'"}], "re", " ", "out", " ", "of", " ", "bounds"}], " ",
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"dims", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/", "2"}], "<", 
        RowBox[{"Abs", "[", 
         RowBox[{"pos", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"dims", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "/", "2"}], "<", 
        RowBox[{"Abs", "[", 
         RowBox[{"pos", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Loop", " ", "over", " ", "each", " ", "of", " ", "the", " ", 
       "elements"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Convert", " ", "the", " ", "coordinates", " ", "to", " ", "the", " ", 
        "coordinates", " ", "in", " ", "that", " ", "space"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"local", " ", "=", " ", 
         RowBox[{"CoordsToLocalSpace", "[", 
          RowBox[{
           RowBox[{"entry", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"entry", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"entry", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
           RowBox[{"entry", "[", 
            RowBox[{"[", "4", "]"}], "]"}], ",", " ", "pos"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"match", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"entry", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "[", "\"\<bounds\>\"", "]"}], " ",
           "/.", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x", " ", "->", " ", 
             RowBox[{"local", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
            RowBox[{"y", "->", 
             RowBox[{"local", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"If", " ", 
           RowBox[{"it", "'"}], "s", " ", "not", " ", "in", " ", "the", " ", 
           "bounds", " ", "of", " ", "the", " ", "element"}], ",", " ", 
          RowBox[{"skip", " ", "that", " ", "element"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", "match"}], ",", 
          RowBox[{"Continue", "[", "]"}]}], " ", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Check", " ", "farther"}], "..."}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{
            RowBox[{
             RowBox[{"entry", "[", 
              RowBox[{"[", "5", "]"}], "]"}], "[", "\"\<checkFunc\>\"", "]"}],
             "[", 
            RowBox[{
             RowBox[{"local", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"local", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"local", "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{"local", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"Continue", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Apply", " ", "the", " ", "update", " ", "function", " ", "to", " ", 
          "the", " ", "particle"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"local", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"entry", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "[", "\"\<updateFunc\>\"", "]"}], 
          "[", 
          RowBox[{
           RowBox[{"local", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"local", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"local", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", 
           RowBox[{"local", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Convert", " ", "the", " ", "local", " ", "coordinates", " ", "back",
           " ", "to", " ", "the", " ", "coordinates", " ", "in", " ", "that", 
          " ", 
          RowBox[{"space", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pos", " ", "=", " ", 
         RowBox[{"LocalSpaceToCoords", "[", 
          RowBox[{
           RowBox[{"entry", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"entry", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"entry", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", 
           RowBox[{"entry", "[", 
            RowBox[{"[", "4", "]"}], "]"}], ",", "local"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", " ", 
           RowBox[{"they", "'"}], "re", " ", "out", " ", "of", " ", 
           "bounds"}], ",", " ", 
          RowBox[{"return", " ", 
           RowBox[{"nothing", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"dims", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "/", "2"}], "<", 
           RowBox[{"Abs", "[", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
          RowBox[{"Return", "[", 
           RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"dims", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "/", "2"}], "<", 
           RowBox[{"Abs", "[", 
            RowBox[{"pos", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", 
          RowBox[{"Return", "[", 
           RowBox[{"{", "}"}], "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
       ",", " ", 
       RowBox[{"{", 
        RowBox[{"entry", ",", " ", "elements"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "pos", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8758192422757044`*^9, 3.875819264482301*^9}, {
   3.875819367284054*^9, 3.8758195714114695`*^9}, {3.8758196449372797`*^9, 
   3.8758197453772907`*^9}, {3.87581979264505*^9, 3.8758199511863213`*^9}, {
   3.875821163050356*^9, 3.8758213604780254`*^9}, {3.8758213921256733`*^9, 
   3.8758215372683744`*^9}, {3.875821697165834*^9, 3.875821703387765*^9}, {
   3.875828771020103*^9, 3.8758287844218507`*^9}, {3.875829090231949*^9, 
   3.8758291319933243`*^9}, {3.8758291849281144`*^9, 3.875829268731877*^9}, {
   3.875829299600464*^9, 3.8758296069429274`*^9}, {3.8758296501533575`*^9, 
   3.8758296532676525`*^9}, {3.8758297306539946`*^9, 3.875829949931053*^9}, {
   3.8758300145096884`*^9, 3.8758300299774847`*^9}, {3.8758300727379427`*^9, 
   3.87583019315124*^9}, {3.875830238209586*^9, 3.875830260740255*^9}, {
   3.8758312181442223`*^9, 3.8758312734946823`*^9}, {3.8758313080933886`*^9, 
   3.875831417839187*^9}, {3.8758320396138306`*^9, 3.875832048239953*^9}, {
   3.875832105439602*^9, 3.875832260066599*^9}, {3.8758323025896873`*^9, 
   3.875832308862008*^9}, {3.8758323437360325`*^9, 3.875832394303035*^9}, {
   3.875832458092029*^9, 3.8758324601991243`*^9}, {3.8758327078220844`*^9, 
   3.8758327233005686`*^9}, {3.8758330751227827`*^9, 3.875833075625787*^9}, {
   3.8758331112810583`*^9, 3.875833111389119*^9}, {3.875833487328435*^9, 
   3.8758334897047544`*^9}, 3.87583352820004*^9, {3.875833593486422*^9, 
   3.875833597858395*^9}, {3.875833668855937*^9, 3.8758336744925756`*^9}, {
   3.875834227068447*^9, 3.875834247260773*^9}, {3.8758365033881736`*^9, 
   3.8758365068596835`*^9}, {3.8758366129207373`*^9, 
   3.8758366350507693`*^9}, {3.8758367143287106`*^9, 3.87583673044934*^9}, {
   3.875836805054844*^9, 3.8758368332229204`*^9}, {3.875836916835823*^9, 
   3.8758369251588454`*^9}, {3.875838318421073*^9, 3.87583834852584*^9}, {
   3.8759121067731476`*^9, 3.875912107078147*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"24f4c1aa-6a24-471b-8a12-e8bea15caf4a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Utility", " ", 
    RowBox[{"function", ":", " ", 
     RowBox[{
     "Convert", " ", "coordinates", " ", "from", " ", "the", " ", "global", 
      " ", "space", " ", "to", " ", "an", " ", 
      RowBox[{"element", "'"}], "s", " ", "local", " ", 
      RowBox[{"space", "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CoordsToLocalSpace", "[", 
     RowBox[{
     "xO_", ",", "yO_", ",", " ", "theta_", ",", " ", "scale_", ",", " ", 
      "coords_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cP", ",", " ", "vP", ",", " ", "dP"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Compute", " ", "the", " ", "difference", " ", "ahead", " ", "of", 
         " ", "time", " ", "so", " ", "we", " ", "can", " ", "make", " ", 
         "sure", " ", 
         RowBox[{"it", "'"}], "s", " ", "not", " ", "0"}], ",", " ", "0"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dP", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"coords", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", "xO"}], ",", 
          RowBox[{
           RowBox[{"coords", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", "yO"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Convert", " ", "the", " ", "offset", " ", "coordinates", " ", "to", 
          " ", "polar", " ", "coordinates"}], ",", " ", 
         RowBox[{"and", " ", "rotate", " ", "it"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"cP", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dP", "==", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "0"}], "}"}]}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", " ", 
          RowBox[{
           RowBox[{"ToPolarCoordinates", "[", "dP", "]"}], " ", "-", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "theta"}], "}"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Make", " ", "sure", " ", "the", " ", "value", " ", "of", " ", 
         "theta", " ", "is", " ", "still", " ", "within", " ", "the", " ", 
         "expected", " ", 
         RowBox[{"range", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"cP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "<=", 
          RowBox[{"-", "Pi"}]}], ",", " ", 
         RowBox[{
          RowBox[{"cP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"cP", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "+", 
           RowBox[{"2", " ", "Pi"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Convert", " ", "it", " ", "to", " ", "regular", " ", 
          "coordinates"}], ",", " ", 
         RowBox[{
         "and", " ", "divide", " ", "by", " ", "the", " ", "scale", " ", "of",
           " ", "the", " ", 
          RowBox[{"space", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"cP", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"cP", "==", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{
           RowBox[{"FromPolarCoordinates", "[", "cP", "]"}], "/", "scale"}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Do", " ", "the", " ", "same", " ", 
         RowBox[{"thing", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"dP", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"coords", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"coords", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vP", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dP", "==", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{
           RowBox[{"ToPolarCoordinates", "[", "dP", "]"}], "-", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "theta"}], "}"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"vP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "<=", 
          RowBox[{"-", "Pi"}]}], ",", " ", 
         RowBox[{
          RowBox[{"vP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"vP", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "+", 
           RowBox[{"2", " ", "Pi"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"vP", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"vP", "==", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{
           RowBox[{"FromPolarCoordinates", "[", "vP", "]"}], "/", "scale"}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"cP", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"cP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"vP", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"vP", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"LocalSpaceToCoords", "[", 
     RowBox[{
     "xO_", ",", "yO_", ",", "theta_", ",", "scale_", ",", "coords_"}], "]"}],
     ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cP", ",", " ", "vP", ",", " ", "dP"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "This", " ", "just", " ", "does", " ", "the", " ", "reverse", " ", 
        "of", " ", 
        RowBox[{"CoordsToLocalSpace", ".", " ", "See"}], " ", "there", " ", 
        "for", " ", 
        RowBox[{"comments", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dP", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"coords", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"coords", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cP", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dP", "==", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{
           RowBox[{"ToPolarCoordinates", "[", 
            RowBox[{"dP", " ", "scale"}], "]"}], "+", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "theta"}], "}"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"cP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ">", "Pi"}], ",", " ", 
         RowBox[{
          RowBox[{"cP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"cP", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", 
           RowBox[{"2", " ", "Pi"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"cP", "=", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"cP", "==", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"FromPolarCoordinates", "[", "cP", "]"}]}], "]"}], " ", 
         "+", " ", 
         RowBox[{"{", 
          RowBox[{"xO", ",", " ", "yO"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"dP", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"coords", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"coords", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vP", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dP", "==", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{
           RowBox[{"ToPolarCoordinates", "[", 
            RowBox[{"dP", " ", "scale"}], "]"}], "+", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "theta"}], "}"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"vP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ">", "Pi"}], ",", " ", 
         RowBox[{
          RowBox[{"cP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"cP", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", 
           RowBox[{"2", "Pi"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"vP", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"vP", "==", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"FromPolarCoordinates", "[", "vP", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"cP", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"cP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"vP", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"vP", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQnX3ufU7XgzeOt71+94DozV0Ms0B0PRP/YRCdudzv
OIiWqZE/A6Ir3vF+A9E73+aA6QczGhm7gXTD4v9gelGRDRuIZtwWyA6i3f7N
5QXR57aeAtP35vk394Fom7CVIJr/9TKHfiCd8izWF0R7bOUMAtFyKk2hIDqq
nikKRG9Z/ScORE/yel4MomP/MM4D0QylxaETgLS6qVMUiH7+vTwLRDus4c4G
0Wqyt/aB6KBNcQdAdEr3h1MguvJdzGkQzedeaTgRSPMuZjQG0Xf+RJpOBtLv
4i6agWiFPDZHEO22NNIJRAMARlSsWQ==
  "],
 CellLabel->"In[19]:=",ExpressionUUID->"1fe83e48-d7f4-4c0d-b704-b106d33bba63"]
},
WindowSize->{766.8, 825.5999999999999},
WindowMargins->{{-4.8, Automatic}, {Automatic, 0}},
TaggingRules-><|"TryRealOnly" -> False|>,
FrontEndVersion->"13.1 for Microsoft Windows (64-bit) (August 22, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"3ba1dc9f-861a-439a-857a-f183b03da70d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 178, 3, 28, "Input",ExpressionUUID->"2105f55d-ac97-4ab9-a64d-6df410f46ac2"],
Cell[CellGroupData[{
Cell[761, 27, 1395, 32, 67, "Input",ExpressionUUID->"c39da14e-dbc7-4489-88bd-45449c789b4f"],
Cell[2159, 61, 8460, 142, 289, "Output",ExpressionUUID->"6c809ca2-1711-4c72-97c8-ea7626c05acf"]
}, Open  ]],
Cell[10634, 206, 152, 3, 28, "Input",ExpressionUUID->"31069f6a-6b6e-4274-805a-65f1de1a729d"],
Cell[CellGroupData[{
Cell[10811, 213, 7010, 162, 428, "Input",ExpressionUUID->"21ecdc82-dd4f-4d00-b944-28dc82a281f7"],
Cell[17824, 377, 7747, 127, 423, "Output",ExpressionUUID->"abc41490-edaa-4420-b5a2-4141d82f1eb5"]
}, Open  ]],
Cell[25586, 507, 7624, 174, 485, "Input",ExpressionUUID->"a4a19f7c-f271-4908-b655-cd6619e20e9d"],
Cell[CellGroupData[{
Cell[33235, 685, 4809, 106, 523, "Input",ExpressionUUID->"7ce3a26c-3531-4f71-b4bf-dc6f3e5026a7"],
Cell[38047, 793, 11620, 375, 394, "Output",ExpressionUUID->"dff6c7b9-eefc-4811-86de-50291bee6535"]
}, Open  ]],
Cell[49682, 1171, 154, 3, 28, "Input",ExpressionUUID->"1ef12c1f-d7d6-45cb-8866-260e1b01cedc"],
Cell[49839, 1176, 9976, 226, 638, "Input",ExpressionUUID->"24f4c1aa-6a24-471b-8a12-e8bea15caf4a"],
Cell[59818, 1404, 10887, 290, 619, "Input",ExpressionUUID->"1fe83e48-d7f4-4c0d-b704-b106d33bba63"]
}
]
*)

